{% extends 'layout.html' %}
{% from 'aux_macros.html' import result_item, category_head %}

{% block app_content %}

    {% if 'get'==method %}
        {% include 'bar_search.html' %}
        <div class="s01 padding-5">
            <p>Search results are sorted by validity into three categories:<br>
                <strong>highly validated</strong> results,
                where the reference is tagged with the subject in more than one book; <br>
                <strong>validated</strong> results,
                where the reference is tagged with the subject only in one book, but more than once; <br>
                and <strong>non-validated</strong> results,
                where the reference is tagged with the subject only once, in one book.
            </p>
        </div>
    {% elif 'by_subject'==search_by %}
        <div id='loading_bar' style='display: none;'>
            <div class="d-flex justify-content-center text-center" style="height: 40rem">
                <div class="spinner-grow text-primary m-5" role="status" style="width: 25rem; height: 25rem;">
                    <span class="sr-only">Loading...</span> {# For accessibility purposes #}
                </div>
            </div>
        </div>
        <div id='search_content'>
            <div class='container-fluid padding-bot-2'>
                <div class='row'>
                    <!-- Title & Results Info -->
                    <div class='col-lg-4 text-center '>
                        <h1 class='display-4 head-title padding-bot-2'>
                            There are {{ results_num }} results for: <em>{{ search_word }}</em>
                        </h1>
                        {% for id, category in categories.items() %}
                            <h6>{{ category['results']|length }}
                                <a class="popover_category" href='#{{ id }}'>{{ category['name'] }} </a> results.
                            </h6>
                        {% endfor %}
                    </div>
                    <!-- Search & Filter Forms -->
                    <div class='col-lg-8'>
                        {#                        <p class='padding-1 color-accent text-center small'>Query time: {{ query_time|round(3) }} s.</p>#}
                        {% include 'bar_search.html' %}
                    </div>
                </div>
                <hr>
            </div>
            <!-- Results Divided Validation Category Sections -->
            {% for id, category in categories.items() %}
                {{ category_head(category['name'], id) }}
                <div class='category-padding'>
                    {% if not category['results'] %}
                        <h3>No results in this category.</h3>
                        <h4>Try using a different filter or search word.</h4>
                    {% endif %}
                    {% set outer_loop = loop %}
                    <!-- Results (Per Category) -->
                    {% for res in category['results'] %}
                        <div class="padding-bot-2 padding-top-1">
                            {{ result_item(res,index = loop.index) }}
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    {% else %}
        {% include 'bar_search.html' %}
        <h1 class="text-center"> The days are long, but the years are short</h1>
        {% if ref_html %}
            <h4 class="padding-1"> Source Quotes Referenced: </h4>
            <div class="container-fluid padding-5">{{ ref_html|safe }}</div>
        {% else %}
            No Quotes Available for References:
{#        <div class="padding">{request.args["refs"]}</div>#}
        {% endif %}

    {% endif %}
{% endblock %}
