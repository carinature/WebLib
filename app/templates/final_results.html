{% extends 'layout.html' %}

{% block app_content %}


    <div class="container-fluid padding">
        <div class="row head-title text-center">
            <div class="col-12">
                <h1 class="display-4 head-title text-center padding">
                    There are {{ results|length|value_or_zero }} results.</h1>
                <h6>{{ y|value_or_zero }} are <a href="#high">highly validated</a> results.</h6>
                <h6>{{ y|value_or_zero }} are <a href="#valid">validated</a> results.</h6>
                <h6>{{ y|value_or_zero }} are <a href="#not">unvalidated</a> results.</h6>
            </div>
            <hr>
        </div>
    </div>


    {% for category in categories %}
        {{ category_head(category['name'], category['id']) }}
        {% for res in category['results'] %}
            {{ result_item(loop.index, res['author'], res['title'], res['refs_num'], res['refs'], loop.index) }}

            {#            {% set elm_id=num %}#}
            {#            {% set btn_id='btn'~num %}#}
            {#            <button id={{ btn_id }} class="" style="padding:.5em; background-color: var(--accent-color)"#}
            {#                    onclick="more_less_info('{{ btn_id }}','{{ elm_id }}')">Show More#}
            {#            </button>#}
            {#            <br><br>#}
            {#            <p   class="display-none" id={{ elm_id }}>#}
            {#                preview of the text (???)#}
            {#            </p>#}
        {% endfor %}
    {% endfor %}


    {% for num, res in results.items() %}
        {{ result_item(
        index = loop.index,
        author=res.author,
        title=res.title,
        books=res.books,
        refs=res.refs,
        num=num) }}
        <br>
    {% endfor %}


    <script src='../static/js/script.js'></script>

{% endblock %}


{% macro result_item(index = 0, author='', title='', books={}, refs=[], num='') -%}
    {% set relm_id='refs'~num %}
    {% set rbtn_id='refsbtn'~num %}
    <div class="container-fluid">
        {#        <div class="col-12" style=""> <!--todo move the style to css-->#}
        <h4 class="display-inline" style="padding: 10px;">
            {{ index }}. {{ author }}, <em>{{ title }} </em>
        </h4>
        <span class='display-inline'>
            <button class='display-inline'
{#                    class="btn"#}
                    style="background-color: var(--primary-color-light)"
                    onclick="more_less_info('{{ rbtn_id }}','{{ relm_id }}')"
                    id={{ rbtn_id }}>
                references:
            </button>
            <em   class="display-none" id={{ relm_id }}> {{ refs }} </em>
        </span>
        <br>
        <div style="padding-left: 2em">
            {% for book in books %}
                <br><em><strong>{{ book.title_full }}</strong></em>, &nbsp; pages:
                {#                {{ book.pages }}#}
                {% for page in book.pages -%}
                    <a href="{{ link|value_or_empty }}"> {{ page }} </a>
                    {#                    {% if loop.index!=(books|length) %}, {% endif %}#}
                {%- endfor %}
                <br>
            {% endfor %}<br>
            <br><br>
        </div>
    </div>
{%- endmacro %}

{% macro category_head(category='', id='', res_num='', value='') -%}
    <div class="container-fluid padding" id="{{ id }}">
        <div class="col-12  bgn-light-second"> <!--todo move the style to css-->
            <h1 class="">{{ category }} {{ res_num }}</h1>
            {#            <h1 class="display-4 welcome text-center">Tiresias: The Ancient Mediterranean Religions Source Database</h1>#}
        </div>
    </div>
{%- endmacro %}

